<div class="list-container">
  <!-- Header Section -->
  <div class="list-header">
    <div>
      <h1 class="list-title">Fichajes</h1>
      <p class="list-subtitle">Gestiona y visualiza el historial de fichajes</p>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-card">
    <div class="filters-header">
      <h5 class="filters-title">
        <i class="bi bi-funnel"></i>
        Filtros de búsqueda
      </h5>
      <button class="btn-clear-filters" (click)="clear()" title="Limpiar todos los filtros">
        <i class="bi bi-x-circle"></i>
        Limpiar filtros
      </button>
    </div>

    <form class="filters-form">
      <div class="filters-grid">
        <!-- Rango Horario -->
        <div class="filter-group">
          <label class="filter-label">Hora Desde</label>
          <div class="filter-input-wrapper">
            <app-input-filter-range-time
              [(inputValue)]="dto.horaDesde"
              (clear)="clearHoraDesde()"
              (list)="listarElementos()"
              [name]="'Hora Desde'"
              [id]="'hora-desde'">
            </app-input-filter-range-time>
          </div>
        </div>

        <div class="filter-group">
          <label class="filter-label">Hora Hasta</label>
          <div class="filter-input-wrapper">
            <app-input-filter-range-time
              [(inputValue)]="dto.horaHasta"
              (clear)="clearHoraHasta()"
              (list)="listarElementos()"
              [name]="'Hora Hasta'"
              [id]="'hora-hasta'">
            </app-input-filter-range-time>
          </div>
        </div>

        <!-- Rango de Fechas -->
        <div class="filter-group">
          <label class="filter-label">Desde</label>
          <div class="filter-input-wrapper">
            <app-input-filter-range-dates
              [(inputValue)]="dto.diaDesde"
              (clear)="clearDiaDesde()"
              (list)="listarElementos()"
              [name]="'Desde'"
              [id]="'desde'">
            </app-input-filter-range-dates>
          </div>
        </div>

        <div class="filter-group">
          <label class="filter-label">Hasta</label>
          <div class="filter-input-wrapper">
            <app-input-filter-range-dates
              [(inputValue)]="dto.diaHasta"
              (clear)="clearDiaHasta()"
              (list)="listarElementos()"
              [name]="'Hasta'"
              [id]="'hasta'">
            </app-input-filter-range-dates>
          </div>
        </div>

        <!-- Admin Filters -->
        <ng-container *ngIf="isAdmin">
          <div class="filter-group">
            <label class="filter-label">Nombre Empleado</label>
            <div class="filter-input-wrapper">
              <app-input-filter-text
                [(inputValue)]="dto.nombreUsuario"
                (clear)="clearNombre()"
                (list)="listarElementos()"
                [name]="'Nombre Emp'"
                [id]="'nombre'">
              </app-input-filter-text>
            </div>
          </div>

          <div class="filter-group">
            <label class="filter-label">Número Empleado</label>
            <div class="filter-input-wrapper">
              <app-input-filter-text
                [(inputValue)]="dto.numeroUsuario"
                (clear)="clearNumero()"
                (list)="listarElementos()"
                [name]="'Número Emp'"
                [id]="'numero'">
              </app-input-filter-text>
            </div>
          </div>
        </ng-container>
      </div>
    </form>
  </div>

  <!-- Results Section -->
  <div class="results-card">
    <div class="results-header">
      <h5 class="results-title">
        <i class="bi bi-list-ul"></i>
        Resultados
      </h5>
      <app-boton-descarga-csv
        [apiEndPoint]="'fichaje/listFiltered'"
        [dto]="dto"
        [fileName]="'fichajes'"
        [service]="service"
        [headers]="headers">
      </app-boton-descarga-csv>
    </div>

    <!-- Table -->
    <div class="table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <th>
              <app-th-sort
                [entity]="'dia'"
                [name]="'Día'"
                [asc]="asc"
                [order]="order"
                (sort)="setOrder($event)">
              </app-th-sort>
            </th>
            <th>
              <app-th-sort
                [entity]="'hora'"
                [name]="'Hora'"
                [asc]="asc"
                [order]="order"
                (sort)="setOrder($event)">
              </app-th-sort>
            </th>
            <th>
              <app-th-sort
                [entity]="'tipo'"
                [name]="'Tipo'"
                [asc]="asc"
                [order]="order"
                (sort)="setOrder($event)">
              </app-th-sort>
            </th>
            <th>
              <app-th-sort
                [entity]="'usuarioNombreEmpleado'"
                [name]="'Nombre Empleado'"
                [asc]="asc"
                [order]="order"
                (sort)="setOrder($event)">
              </app-th-sort>
            </th>
            <th>
              <app-th-sort
                [entity]="'usuarioNumero'"
                [name]="'Número Empleado'"
                [asc]="asc"
                [order]="order"
                (sort)="setOrder($event)">
              </app-th-sort>
            </th>
            <th>
              <app-th-sort
                [entity]="'origen'"
                [name]="'Origen'"
                [asc]="asc"
                [order]="order"
                (sort)="setOrder($event)">
              </app-th-sort>
            </th>
            <th class="actions-column">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let elemento of listaElementos" class="table-row">
            <td class="cell-date">{{ elemento.dia }}</td>
            <td class="cell-time">{{ elemento.hora }}</td>
            <td class="cell-type">
              <span class="badge-type" [ngClass]="'type-' + (elemento.tipo | lowercase)">
                {{ elemento.tipo }}
              </span>
            </td>
            <td class="cell-name">{{ elemento.usuario.nombreEmpleado }}</td>
            <td class="cell-number">{{ elemento.usuario.numero }}</td>
            <td class="cell-origin">
              <span class="badge-origin" [ngClass]="'origin-' + (elemento.origen | lowercase)">
                {{ elemento.origen }}
              </span>
            </td>
            <td class="cell-actions">
              <button
                *ngIf="isAdmin"
                class="btn-view-detail"
                [routerLink]="'/intranet/fichajes/list/' + elemento.id"
                title="Ver detalles">
                <i class="bi bi-eye"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination-wrapper">
      <app-pagination [pag]="pag" (paginacion)="onPaginate($event)"></app-pagination>
    </div>
  </div>
</div>

